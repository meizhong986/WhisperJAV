# WhisperJAV v1.7.5 Requirements
# ================================
#
# This file lists all Python dependencies for WhisperJAV.
# PyTorch is installed separately in post_install_v1.7.5.py
# with CUDA version detection.
#
# IMPORTANT: Use with constraints file to prevent version conflicts:
#   pip install -c constraints_v1.7.5.txt -r requirements_v1.7.5.txt
#
# Installation is performed in phases to ensure dependency compatibility.

# ============================================================================
# PHASE 1: Core Scientific Stack (Install FIRST)
# ============================================================================
# These packages MUST be installed first to establish version constraints
# before any packages that might try to downgrade them.

numpy>=2.0                # NumPy 2.x (required for librosa 0.11+)
scipy>=1.10.1             # Signal processing
librosa>=0.11.0           # Audio analysis (NumPy 2.x compatible)

# ============================================================================
# PHASE 2: Core Whisper Dependencies
# ============================================================================
# Git-based installs from main branches

openai-whisper @ git+https://github.com/openai/whisper@main
stable-ts @ git+https://github.com/meizhong986/stable-ts-fix-setup.git@main

# Whisper variants
faster-whisper>=1.1.0

# ============================================================================
# PHASE 3: Audio and Signal Processing
# ============================================================================

ffmpeg-python @ git+https://github.com/kkroening/ffmpeg-python.git  # PyPI tarball fails
soundfile                 # Audio file I/O
auditok                   # Voice Activity Detection (VAD)
silero-vad>=6.0           # Silero VAD for scene detection
ten-vad                   # TEN Framework VAD for speech segmentation
pyloudnorm                # Audio normalization
pydub                     # Audio manipulation

# ============================================================================
# PHASE 4: Speech Enhancement Backends (Required Functionality)
# ============================================================================
# CRITICAL: These packages have aggressive dependencies that can conflict.
# Install with constraints.txt to prevent numpy/datasets downgrades.

# ModelScope ecosystem (ZipEnhancer - lightweight SOTA)
modelscope>=1.20
addict                    # ModelScope dependency (dict with attribute access)
datasets>=2.14.0,<4.0     # CRITICAL: 4.x breaks modelscope
simplejson                # ModelScope dependency (JSON parsing)
sortedcontainers          # ModelScope dependency (sorted collections)
packaging                 # ModelScope dependency (version parsing)

# ClearVoice denoising (48kHz) - NumPy 2.x compatible fork
clearvoice @ git+https://github.com/meizhong986/ClearerVoice-Studio.git#subdirectory=clearvoice

# BS-RoFormer vocal isolation (44.1kHz)
bs-roformer-infer

# ONNX runtime for ZipEnhancer ONNX mode
onnxruntime>=1.16.0

# ============================================================================
# PHASE 5: GUI Framework (PyWebView)
# ============================================================================

pywebview>=5.0.0          # Modern web-based GUI framework
pythonnet>=3.0            # Required for WebView2 backend on Windows
pywin32>=305; platform_system=="Windows"  # Windows COM support for shortcuts

# ============================================================================
# PHASE 6: HuggingFace Transformers Pipeline
# ============================================================================

huggingface-hub>=0.25.0   # Hugging Face cache management (faster-whisper models)
transformers>=4.40.0      # HuggingFace Transformers for ASR pipeline
accelerate>=0.26.0        # Efficient model loading for Transformers
hf_xet                    # Faster HuggingFace downloads (Xet Storage)

# ============================================================================
# PHASE 7: Subtitle Processing and Translation
# ============================================================================

pysrt                     # SRT file parsing
srt                       # SRT utilities
PySubtrans>=0.7.0         # AI-powered subtitle translation
openai>=1.35.0            # Required for GPT provider in PySubtrans
google-genai>=1.39.0      # Required for Gemini provider in PySubtrans

# ============================================================================
# PHASE 8: Utilities and Configuration
# ============================================================================

tqdm                      # Progress bars
aiofiles                  # Async file I/O
jsonschema                # Config validation
Pillow                    # Image processing (GUI)
colorama                  # Colored console output
requests                  # HTTP requests
regex                     # Advanced regular expressions
psutil>=5.9.0             # Process management (clean subprocess cleanup)

# Configuration system
pydantic>=2.0,<3.0        # Data validation (used in config schemas)
PyYAML>=6.0               # YAML config file parsing

# ============================================================================
# PHASE 9: Performance Optimization
# ============================================================================

numba                     # JIT compilation for speedups
scikit-learn>=1.3.0       # Clustering for semantic scene detection
