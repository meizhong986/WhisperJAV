<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WhisperJAV - Simple Runner</title>
    <!-- Theme stylesheet (swappable at runtime) -->
    <link id="themeStylesheet" rel="stylesheet" href="style.css">
</head>
<body>
    <!-- Main Application Container -->
    <div class="app-container">

        <!-- Header -->
        <header class="app-header">
            <h1>WhisperJAV</h1>
            <div class="header-actions">
                <!-- Minimal theme switch button -->
                <button id="themeBtn" class="theme-button" aria-label="Theme" title="Theme">
                    üé®
                </button>
                <!-- Tiny popover menu -->
                <div id="themeMenu" class="theme-menu" role="menu" aria-label="Select theme">
                    <button class="theme-option" data-theme="default" role="menuitem">Default Theme</button>
                    <button class="theme-option" data-theme="google" role="menuitem">Google Theme</button>
                    <button class="theme-option" data-theme="carbon" role="menuitem">IBM Carbon Theme</button>
                    <button class="theme-option" data-theme="primer" role="menuitem">GitHub Primer Theme</button>
                </div>
            </div>
        </header>

        <!-- Main Content Area -->
        <main class="app-main">

            <!-- Source Section -->
            <section class="section source-section">
                <div class="section-header">
                    <h2>Source</h2>
                </div>
                <div class="section-content">
                    <!-- File List Display -->
                    <div class="file-list-container" id="fileListContainer">
                        <div class="file-list" id="fileList" tabindex="0">
                            <div class="empty-state" id="emptyState">
                                <span class="empty-icon">üìÇ</span>
                                <p>No files selected</p>
                                <p class="empty-hint">Click "Add File(s)" or "Add Folder" to get started</p>
                            </div>
                        </div>
                    </div>

                    <!-- File Management Buttons -->
                    <div class="button-group">
                        <button type="button" class="btn btn-primary" id="addFilesBtn">
                            Add File(s)
                        </button>
                        <button type="button" class="btn btn-primary" id="addFolderBtn">
                            Add Folder
                        </button>
                        <button type="button" class="btn btn-secondary" id="removeSelectedBtn" disabled>
                            Remove Selected
                        </button>
                        <button type="button" class="btn btn-secondary" id="clearBtn" disabled>
                            Clear
                        </button>
                    </div>
                </div>
            </section>

            <!-- Destination Section -->
            <section class="section destination-section">
                <div class="section-header">
                    <h2>Destination</h2>
                </div>
                <div class="section-content">
                    <div class="output-control">
                        <label for="outputDir" class="control-label">Output:</label>
                        <input
                            type="text"
                            id="outputDir"
                            class="output-path"
                            readonly
                            placeholder="Output directory..."
                        >
                        <button type="button" class="btn btn-secondary" id="browseOutputBtn">
                            Browse
                        </button>
                        <button type="button" class="btn btn-secondary" id="openOutputBtn">
                            Open
                        </button>
                    </div>
                </div>
            </section>

            <!-- Tabbed Options Section -->
            <section class="section tabs-section">
                <div class="tabs-container">
                    <!-- Tab Navigation -->
                    <div class="tab-bar" role="tablist">
                        <button
                            class="tab-button active"
                            role="tab"
                            aria-selected="true"
                            aria-controls="tab1-panel"
                            id="tab1-button"
                            data-tab="tab1"
                        >
                            Transcription Mode
                        </button>
                        <button
                            class="tab-button"
                            role="tab"
                            aria-selected="false"
                            aria-controls="tab2-panel"
                            id="tab2-button"
                            data-tab="tab2"
                        >
                            Transcription Adv. Options
                        </button>
                        <button
                            class="tab-button"
                            role="tab"
                            aria-selected="false"
                            aria-controls="tab3-panel"
                            id="tab3-button"
                            data-tab="tab3"
                        >
                            Ensemble Mode
                        </button>
                    </div>

                    <!-- Tab Content -->
                    <div class="tab-content-container">

                        <!-- Tab 1: Transcription Mode -->
                        <div
                            class="tab-panel active"
                            id="tab1-panel"
                            role="tabpanel"
                            aria-labelledby="tab1-button"
                        >
                            <!-- Row 1: Mode + Sensitivity (left), Source language + Subtitle output (right) -->
                            <div class="form-row form-row-two-column">
                                <!-- Left Column: Mode + Sensitivity -->
                                <div class="form-column">
                                    <!-- Mode Selection -->
                                    <div class="form-group">
                                        <label for="mode" class="form-label">Mode (ASR Engine options):</label>
                                        <select id="mode" class="form-select mode-select">
                                            <option value="fidelity">fidelity&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(large-v2-fp16&nbsp;&nbsp;&nbsp;10GB VRAM)</option>
                                            <option value="balanced" selected>balanced&nbsp;&nbsp;&nbsp;&nbsp;(large-v2-int8&nbsp;&nbsp;&nbsp;&nbsp;6GB VRAM)</option>
                                            <option value="fast">fast&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(turbo-int8&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;4GB VRAM)</option>
                                            <option value="faster">faster&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(turbo-int8-batch8&nbsp;&nbsp;6GB VRAM)</option>
                                            <!-- kotoba-faster-whisper temporarily hidden (implementation preserved)
                                            <option value="kotoba-faster-whisper">kotoba&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(kotoba-v2-fp16&nbsp;&nbsp;&nbsp;6GB VRAM)</option>
                                            -->
                                            <option value="transformers">transformers&nbsp;&nbsp;(HF kotoba-bilingual&nbsp;6GB VRAM)</option>
                                            <option value="anime" disabled>anime (future placeholder)</option>
                                        </select>
                                    </div>

                                    <!-- Sensitivity -->
                                    <div class="form-group">
                                        <label for="sensitivity" class="form-label">Sensitivity (accuracy vs false-positives):</label>
                                        <select id="sensitivity" class="form-select">
                                            <option value="aggressive" selected>aggressive (hi-details, noise)</option>
                                            <option value="balanced">balanced (details, lo-noise)</option>
                                            <option value="conservative">conservative (lo-details, accurate)</option>
                                        </select>
                                    </div>
                                </div>

                                <!-- Right Column: Source Audio Language + Subtitle Output -->
                                <div class="form-column">
                                    <!-- Source Audio Language -->
                                    <div class="form-group">
                                        <label for="source-language" class="form-label">Source audio language:</label>
                                        <select id="source-language" class="form-select">
                                            <option value="japanese" selected>Japanese (Êó•Êú¨Ë™û)</option>
                                            <option value="korean">Korean (ÌïúÍµ≠Ïñ¥)</option>
                                            <option value="chinese">Chinese (‰∏≠Êñá)</option>
                                            <option value="english">English</option>
                                        </select>
                                    </div>

                                    <!-- Subtitle Output Format -->
                                    <div class="form-group">
                                        <label for="language" class="form-label">Subtitle output:</label>
                                        <select id="language" class="form-select">
                                            <option value="native" selected>Native (transcribe in source language)</option>
                                            <option value="direct-to-english">Direct to English (translate via Whisper)</option>
                                        </select>
                                    </div>
                                </div>
                            </div>

                            <!-- Row 2: Info Labels -->
                            <div class="form-row info-row">
                                <div class="info-group">
                                    <p class="info-text">
                                        Speed vs. Accuracy: 'fast' and 'faster' prioritize throughput; <br>'fidelity' favors accuracy.
                                    </p>
                                </div>
                                <div class="info-group">
                                    <p class="info-text">
                                        Details vs. Noise: 'conservative' reduces false positives; <br>'aggressive' may include noise while capturing more detail.
                                    </p>
                                </div>
                            </div>

                            <!-- Row 3: Transformers Info (shown when transformers mode selected) -->
                            <div class="form-row info-row transformers-info" id="transformersInfoRow" style="display: none;">
                                <div class="info-group full-width">
                                    <p class="info-text info-transformers">
                                        <strong>Transformers Mode:</strong> Uses HuggingFace pipeline with chunked long-form algorithm.
                                        Sensitivity presets do not apply. Use Ensemble tab's "Customize Parameters" button for fine-tuning.
                                    </p>
                                </div>
                            </div>
                        </div>

                        <!-- Tab 2: Advanced Options -->
                        <div
                            class="tab-panel"
                            id="tab2-panel"
                            role="tabpanel"
                            aria-labelledby="tab2-button"
                        >
                            <!-- Row 1 (new): Model override + model select + Async + Debug -->
                            <div class="form-row" id="adv-row-1">
                                <div class="form-group">
                                    <label class="checkbox-label">
                                        <input type="checkbox" id="modelOverrideEnabled">
                                        <span>Model override</span>
                                    </label>
                                </div>
                                <div class="form-group tight-pair">
                                    <select id="modelSelection" class="form-select" disabled>
                                        <option value="large-v3" selected>large-v3</option>
                                        <option value="large-v2">large-v2</option>
                                        <option value="turbo">turbo</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label class="checkbox-label">
                                        <input type="checkbox" id="asyncProcessing">
                                        <span>Async processing</span>
                                    </label>
                                </div>
                                <div class="form-group">
                                    <label class="checkbox-label">
                                        <input type="checkbox" id="debugLogging">
                                        <span>Debug logging</span>
                                    </label>
                                </div>
                                <div class="form-group inline-field">
                                    <label for="sceneDetectionMethod" class="form-label" style="white-space: nowrap;">Scene detection:</label>
                                    <select id="sceneDetectionMethod" class="form-select">
                                        <option value="">default (auditok)</option>
                                        <option value="auditok">auditok (energy-based)</option>
                                        <option value="silero">silero (VAD-based, experimental)</option>
                                    </select>
                                </div>
                            </div>

                            <!-- Row 2 (new): Opening credit inline -->
                            <div class="form-row" id="adv-row-2">
                                <div class="form-group full-width">
                                    <div class="input-inline">
                                        <label for="openingCredit" class="form-label" style="white-space: nowrap;">Opening credit (Example: Produced by XXX):</label>
                                        <input
                                            type="text"
                                            id="openingCredit"
                                            class="form-input"
                                            placeholder="Optional opening credit text..."
                                        >
                                    </div>
                                </div>
                            </div>

                            <!-- Row 3: Adaptive features + Skip VAD -->
                            <div class="form-row" id="adv-row-3">
                                <div class="form-group">
                                    <label class="checkbox-label" title="Work in Progress - Not yet implemented">
                                        <input type="checkbox" id="adaptiveClassification" disabled>
                                        <span>Adaptive classification (WIP)</span>
                                    </label>
                                </div>
                                <div class="form-group">
                                    <label class="checkbox-label" title="Work in Progress - Not yet implemented">
                                        <input type="checkbox" id="adaptiveEnhancement" disabled>
                                        <span>Adaptive audio enhancements (WIP)</span>
                                    </label>
                                </div>
                                <div class="form-group">
                                    <label class="checkbox-label" title="Work in Progress - Not yet implemented">
                                        <input type="checkbox" id="smartPostprocessing" disabled>
                                        <span>Smart postprocessing (WIP)</span>
                                    </label>
                                </div>
                                <div class="form-group inline-field">
                                    <label for="speechSegmenter" class="form-label" style="white-space: nowrap;">Speech Segmenter:</label>
                                    <select id="speechSegmenter" class="form-select">
                                        <option value="" selected>Silero v4.0 (default)</option>
                                        <option value="silero-v3.1">Silero v3.1</option>
                                        <option value="nemo-lite" disabled title="Requires nemo_toolkit">NeMo Lite (~0.5GB) (N/A)</option>
                                        <option value="whisper-vad">Whisper VAD (small ~500MB)</option>
                                        <option value="whisper-vad-tiny">Whisper VAD (tiny ~75MB)</option>
                                        <option value="whisper-vad-medium">Whisper VAD (medium ~1.5GB)</option>
                                        <option value="ten" disabled title="Requires ten-vad">TEN VAD (N/A)</option>
                                        <option value="none">None (Skip VAD)</option>
                                    </select>
                                </div>
                            </div>

                            <!-- Row 4 (new): Keep temp files + Temp directory -->
                            <div class="form-row" id="adv-row-4">
                                <div class="form-group">
                                    <label class="checkbox-label">
                                        <input type="checkbox" id="keepTemp">
                                        <span>Keep temp files</span>
                                    </label>
                                </div>
                                <div class="form-group temp-dir-group inline-field">
                                    <label for="tempDir" class="form-label" style="white-space: nowrap;">Temp dir:</label>
                                    <div class="input-with-button">
                                        <input
                                            type="text"
                                            id="tempDir"
                                            class="form-input"
                                            placeholder="Default system temp directory"
                                        >
                                        <button type="button" class="btn btn-secondary btn-sm" id="browseTempBtn">
                                            Browse
                                        </button>
                                    </div>
                                </div>
                            </div>

                            <!-- Row 5: Accept CPU mode -->
                            <div class="form-row" id="adv-row-5">
                                <div class="form-group">
                                    <label class="checkbox-label" title="Skip GPU performance warning and accept CPU-only mode">
                                        <input type="checkbox" id="acceptCpuMode">
                                        <span>Accept CPU-only mode (skip GPU warning)</span>
                                    </label>
                                </div>
                            </div>
                        </div>

                        <!-- Tab 3: Two-Pass Ensemble Mode -->
                        <div
                            class="tab-panel"
                            id="tab3-panel"
                            role="tabpanel"
                            aria-labelledby="tab3-button"
                        >
                            <div class="ensemble-grid">
                                <!-- Header Row -->
                                <div class="grid-header">
                                    <div class="col-label"></div>
                                    <div class="col-pipeline">Pipeline</div>
                                    <div class="col-separator"></div>
                                    <div class="col-sensitivity">Sensitivity</div>
                                    <div class="col-separator"></div>
                                    <div class="col-scene">Scene Detector</div>
                                    <div class="col-enhancer">Speech Enhancer</div>
                                    <div class="col-segmenter">Speech Segmenter</div>
                                    <div class="col-separator"></div>
                                    <div class="col-model">Model</div>
                                    <div class="col-actions"></div>
                                </div>

                                <!-- Pass 1 Row -->
                                <div class="grid-row" id="pass1-row">
                                    <div class="col-label">Pass 1</div>
                                    <div class="col-pipeline">
                                        <select id="pass1-pipeline" class="form-select compact">
                                            <option value="balanced" selected>Balanced</option>
                                            <option value="fast">Fast</option>
                                            <option value="faster">Faster</option>
                                            <option value="fidelity">Fidelity</option>
                                            <option value="transformers">Transformers (HF)</option>
                                        </select>
                                    </div>
                                    <div class="col-separator"></div>
                                    <div class="col-sensitivity">
                                        <select id="pass1-sensitivity" class="form-select compact">
                                            <option value="aggressive" selected>Aggressive</option>
                                            <option value="balanced">Balanced</option>
                                            <option value="conservative">Conservative</option>
                                        </select>
                                    </div>
                                    <div class="col-separator"></div>
                                    <div class="col-scene">
                                        <select id="pass1-scene" class="form-select compact">
                                            <option value="auditok" selected>Auditok</option>
                                            <option value="silero">Silero</option>
                                            <option value="none">None</option>
                                        </select>
                                    </div>
                                    <div class="col-enhancer">
                                        <select id="pass1-enhancer" class="form-select compact">
                                            <option value="none" selected>None</option>
                                            <optgroup label="FFmpeg DSP (Lightweight)">
                                                <option value="ffmpeg-dsp">Audio Filters...</option>
                                            </optgroup>
                                            <optgroup label="ZipEnhancer (Recommended)">
                                                <option value="zipenhancer:torch">Torch (GPU)</option>
                                                <option value="zipenhancer:onnx" disabled class="coming-soon">ONNX (Coming Soon)</option>
                                            </optgroup>
                                            <optgroup label="ClearVoice">
                                                <option value="clearvoice:MossFormer2_SE_48K" disabled title="Unstable on 8GB VRAM - causes memory fragmentation">MossFormer2 48kHz (Unstable)</option>
                                                <option value="clearvoice:FRCRN_SE_16K">FRCRN 16kHz</option>
                                                <option value="clearvoice:MossFormerGAN_SE_16K">MossFormerGAN 16kHz</option>
                                                <option value="clearvoice:MossFormer2_SS_16K">MossFormer2 SS 16kHz</option>
                                            </optgroup>
                                            <optgroup label="BS-RoFormer">
                                                <option value="bs-roformer:vocals" disabled class="coming-soon">Vocals (Coming Soon)</option>
                                            </optgroup>
                                        </select>
                                    </div>
                                    <div class="col-segmenter">
                                        <select id="pass1-segmenter" class="form-select compact">
                                            <!-- Options populated dynamically by updateSegmenterOptions() -->
                                            <option value="silero-v4.0" selected>Silero V4.0</option>
                                            <option value="silero-v3.1">Silero V3.1</option>
                                            <option value="nemo-lite" disabled title="Requires nemo_toolkit (not installed)">NeMo Lite (N/A)</option>
                                            <option value="whisper-vad">Whisper Seg. Medium</option>
                                            <option value="ten">TEN</option>
                                            <option value="none">None</option>
                                        </select>
                                    </div>
                                    <div class="col-separator"></div>
                                    <div class="col-model">
                                        <select id="pass1-model" class="form-select compact">
                                            <option value="large-v2" selected>Large V2</option>
                                            <option value="large-v3">Large V3</option>
                                            <option value="turbo">Turbo</option>
                                        </select>
                                    </div>
                                    <div class="col-actions">
                                        <button type="button" class="btn btn-secondary btn-compact" id="customize-pass1">
                                            Customize Parameters
                                        </button>
                                        <span id="pass1-badge" class="pass-badge default">DEFAULT</span>
                                    </div>
                                </div>

                                <!-- Pass 1 DSP Effects Panel (shown when FFmpeg DSP selected) -->
                                <div class="dsp-effects-panel" id="pass1-dsp-panel" style="display: none;">
                                    <div class="dsp-effects-header">
                                        <span class="dsp-icon">üéõÔ∏è</span>
                                        <span class="dsp-title">Audio Filters</span>
                                        <span class="dsp-hint">Select one or more effects to apply</span>
                                    </div>
                                    <div class="dsp-effects-grid">
                                        <label class="dsp-effect-item" title="Normalize loudness to broadcast standard (-16 LUFS)">
                                            <input type="checkbox" name="pass1-dsp" value="loudnorm" checked>
                                            <span class="dsp-effect-name">Loudness Norm</span>
                                            <span class="dsp-effect-desc">EBU R128 standard</span>
                                        </label>
                                        <label class="dsp-effect-item" title="Normalize audio dynamics while preserving natural sound">
                                            <input type="checkbox" name="pass1-dsp" value="normalize">
                                            <span class="dsp-effect-name">Dynamic Norm</span>
                                            <span class="dsp-effect-desc">Preserve natural sound</span>
                                        </label>
                                        <label class="dsp-effect-item" title="Reduce volume difference between loud and quiet parts">
                                            <input type="checkbox" name="pass1-dsp" value="compress">
                                            <span class="dsp-effect-name">Compress</span>
                                            <span class="dsp-effect-desc">Dynamic range control</span>
                                        </label>
                                        <label class="dsp-effect-item" title="Remove background noise using FFT denoising">
                                            <input type="checkbox" name="pass1-dsp" value="denoise">
                                            <span class="dsp-effect-name">Denoise</span>
                                            <span class="dsp-effect-desc">FFT noise reduction</span>
                                        </label>
                                        <label class="dsp-effect-item" title="Remove low rumble and hum below 80Hz">
                                            <input type="checkbox" name="pass1-dsp" value="highpass">
                                            <span class="dsp-effect-name">High-pass</span>
                                            <span class="dsp-effect-desc">Cut below 80Hz</span>
                                        </label>
                                        <label class="dsp-effect-item" title="Remove high frequency hiss above 8kHz">
                                            <input type="checkbox" name="pass1-dsp" value="lowpass">
                                            <span class="dsp-effect-name">Low-pass</span>
                                            <span class="dsp-effect-desc">Cut above 8kHz</span>
                                        </label>
                                        <label class="dsp-effect-item" title="Reduce harsh sibilant sounds (s, sh, ch)">
                                            <input type="checkbox" name="pass1-dsp" value="deess">
                                            <span class="dsp-effect-name">De-esser</span>
                                            <span class="dsp-effect-desc">Reduce sibilance</span>
                                        </label>
                                        <label class="dsp-effect-item" title="Increase volume by 3 decibels">
                                            <input type="checkbox" name="pass1-dsp" value="amplify">
                                            <span class="dsp-effect-name">Amplify</span>
                                            <span class="dsp-effect-desc">+3dB boost</span>
                                        </label>
                                    </div>
                                </div>

                                <!-- Pass 2 Row -->
                                <div class="grid-row" id="pass2-row">
                                    <div class="col-label">
                                        <label class="checkbox-label">
                                            <input type="checkbox" id="pass2-enabled">
                                            <span>Pass 2</span>
                                        </label>
                                    </div>
                                    <div class="col-pipeline">
                                        <select id="pass2-pipeline" class="form-select compact" disabled>
                                            <option value="balanced">Balanced</option>
                                            <option value="fast">Fast</option>
                                            <option value="faster">Faster</option>
                                            <option value="fidelity">Fidelity</option>
                                            <option value="transformers" selected>Transformers (HF)</option>
                                        </select>
                                    </div>
                                    <div class="col-separator"></div>
                                    <div class="col-sensitivity">
                                        <select id="pass2-sensitivity" class="form-select compact" disabled>
                                            <option value="aggressive" selected>Aggressive</option>
                                            <option value="balanced">Balanced</option>
                                            <option value="conservative">Conservative</option>
                                        </select>
                                    </div>
                                    <div class="col-separator"></div>
                                    <div class="col-scene">
                                        <select id="pass2-scene" class="form-select compact" disabled>
                                            <option value="auditok">Auditok</option>
                                            <option value="silero">Silero</option>
                                            <option value="none" selected>None</option>
                                        </select>
                                    </div>
                                    <div class="col-enhancer">
                                        <select id="pass2-enhancer" class="form-select compact" disabled>
                                            <option value="none" selected>None</option>
                                            <optgroup label="FFmpeg DSP (Lightweight)">
                                                <option value="ffmpeg-dsp">Audio Filters...</option>
                                            </optgroup>
                                            <optgroup label="ZipEnhancer (Recommended)">
                                                <option value="zipenhancer:torch">Torch (GPU)</option>
                                                <option value="zipenhancer:onnx" disabled class="coming-soon">ONNX (Coming Soon)</option>
                                            </optgroup>
                                            <optgroup label="ClearVoice">
                                                <option value="clearvoice:MossFormer2_SE_48K" disabled title="Unstable on 8GB VRAM - causes memory fragmentation">MossFormer2 48kHz (Unstable)</option>
                                                <option value="clearvoice:FRCRN_SE_16K">FRCRN 16kHz</option>
                                                <option value="clearvoice:MossFormerGAN_SE_16K">MossFormerGAN 16kHz</option>
                                                <option value="clearvoice:MossFormer2_SS_16K">MossFormer2 SS 16kHz</option>
                                            </optgroup>
                                            <optgroup label="BS-RoFormer">
                                                <option value="bs-roformer:vocals" disabled class="coming-soon">Vocals (Coming Soon)</option>
                                            </optgroup>
                                        </select>
                                    </div>
                                    <div class="col-segmenter">
                                        <select id="pass2-segmenter" class="form-select compact" disabled>
                                            <!-- Options populated dynamically by updateSegmenterOptions() -->
                                            <option value="silero-v4.0">Silero V4.0</option>
                                            <option value="silero-v3.1">Silero V3.1</option>
                                            <option value="nemo-lite" disabled title="Requires nemo_toolkit (not installed)">NeMo Lite (N/A)</option>
                                            <option value="whisper-vad">Whisper Seg. Medium</option>
                                            <option value="ten">TEN</option>
                                            <option value="none" selected>None</option>
                                        </select>
                                    </div>
                                    <div class="col-separator"></div>
                                    <div class="col-model">
                                        <select id="pass2-model" class="form-select compact" disabled>
                                            <option value="kotoba-tech/kotoba-whisper-bilingual-v1.0" selected>Kotoba Bilingual v1.0</option>
                                            <option value="kotoba-tech/kotoba-whisper-v2.2">Kotoba v2.2 (Latest)</option>
                                            <option value="kotoba-tech/kotoba-whisper-v2.1">Kotoba v2.1</option>
                                            <option value="kotoba-tech/kotoba-whisper-v2.0">Kotoba v2.0</option>
                                            <option value="openai/whisper-large-v3-turbo">Whisper Large v3 Turbo</option>
                                            <option value="openai/whisper-large-v2">Whisper Large v2</option>
                                        </select>
                                    </div>
                                    <div class="col-actions">
                                        <button type="button" class="btn btn-secondary btn-compact" id="customize-pass2" disabled>
                                            Customize Parameters
                                        </button>
                                        <span id="pass2-badge" class="pass-badge default">DEFAULT</span>
                                    </div>
                                </div>

                                <!-- Pass 2 DSP Effects Panel (shown when FFmpeg DSP selected) -->
                                <div class="dsp-effects-panel" id="pass2-dsp-panel" style="display: none;">
                                    <div class="dsp-effects-header">
                                        <span class="dsp-icon">üéõÔ∏è</span>
                                        <span class="dsp-title">Audio Filters</span>
                                        <span class="dsp-hint">Select one or more effects to apply</span>
                                    </div>
                                    <div class="dsp-effects-grid">
                                        <label class="dsp-effect-item" title="Normalize loudness to broadcast standard (-16 LUFS)">
                                            <input type="checkbox" name="pass2-dsp" value="loudnorm" checked>
                                            <span class="dsp-effect-name">Loudness Norm</span>
                                            <span class="dsp-effect-desc">EBU R128 standard</span>
                                        </label>
                                        <label class="dsp-effect-item" title="Normalize audio dynamics while preserving natural sound">
                                            <input type="checkbox" name="pass2-dsp" value="normalize">
                                            <span class="dsp-effect-name">Dynamic Norm</span>
                                            <span class="dsp-effect-desc">Preserve natural sound</span>
                                        </label>
                                        <label class="dsp-effect-item" title="Reduce volume difference between loud and quiet parts">
                                            <input type="checkbox" name="pass2-dsp" value="compress">
                                            <span class="dsp-effect-name">Compress</span>
                                            <span class="dsp-effect-desc">Dynamic range control</span>
                                        </label>
                                        <label class="dsp-effect-item" title="Remove background noise using FFT denoising">
                                            <input type="checkbox" name="pass2-dsp" value="denoise">
                                            <span class="dsp-effect-name">Denoise</span>
                                            <span class="dsp-effect-desc">FFT noise reduction</span>
                                        </label>
                                        <label class="dsp-effect-item" title="Remove low rumble and hum below 80Hz">
                                            <input type="checkbox" name="pass2-dsp" value="highpass">
                                            <span class="dsp-effect-name">High-pass</span>
                                            <span class="dsp-effect-desc">Cut below 80Hz</span>
                                        </label>
                                        <label class="dsp-effect-item" title="Remove high frequency hiss above 8kHz">
                                            <input type="checkbox" name="pass2-dsp" value="lowpass">
                                            <span class="dsp-effect-name">Low-pass</span>
                                            <span class="dsp-effect-desc">Cut above 8kHz</span>
                                        </label>
                                        <label class="dsp-effect-item" title="Reduce harsh sibilant sounds (s, sh, ch)">
                                            <input type="checkbox" name="pass2-dsp" value="deess">
                                            <span class="dsp-effect-name">De-esser</span>
                                            <span class="dsp-effect-desc">Reduce sibilance</span>
                                        </label>
                                        <label class="dsp-effect-item" title="Increase volume by 3 decibels">
                                            <input type="checkbox" name="pass2-dsp" value="amplify">
                                            <span class="dsp-effect-name">Amplify</span>
                                            <span class="dsp-effect-desc">+3dB boost</span>
                                        </label>
                                    </div>
                                </div>

                                <!-- Merge Strategy Row -->
                                <div class="grid-row" id="merge-row">
                                    <div class="col-label">Merge</div>
                                    <div class="col-merge">
                                        <select id="merge-strategy" class="form-select merge-select" disabled>
                                            <option value="pass1_primary" selected>Pass 1 + Fill From Pass 2</option>
                                            <option value="smart_merge">Smart Merge (Best Quality)</option>
                                            <option value="full_merge">Full Merge (All Lines)</option>
                                            <option value="pass2_primary">Pass 2 + Fill From Pass 1</option>
                                            <option value="pass1_overlap">Pass 1 + Fill (30% Overlap)</option>
                                            <option value="pass2_overlap">Pass 2 + Fill (30% Overlap)</option>
                                        </select>
                                    </div>
                                </div>

                                <!-- Info Footer -->
                                <div class="ensemble-info">
                                    <p>Two-pass ensemble runs two different pipeline configurations and merges results for improved quality.</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Run Controls Section -->
            <section class="section run-section">
                <div class="section-content">
                    <!-- Progress Bar -->
                    <div class="progress-container">
                        <div class="progress-bar" id="progressBar">
                            <div class="progress-fill" id="progressFill"></div>
                        </div>
                        <span class="status-label" id="statusLabel">Idle</span>
                    </div>

                    <!-- Control Buttons -->
                    <div class="button-group">
                        <button type="button" class="btn btn-primary btn-lg" id="startBtn">
                            Start
                        </button>
                        <button type="button" class="btn btn-secondary btn-lg" id="cancelBtn" disabled>
                            Cancel
                        </button>
                    </div>
                </div>
            </section>

            <!-- Console Section -->
            <section class="section console-section">
                <div class="section-header">
                    <h2>Console</h2>
                    <button type="button" class="btn btn-text btn-sm" id="clearConsoleBtn">
                        Clear
                    </button>
                </div>
                <div class="section-content">
                    <div class="console-output" id="consoleOutput">
                        <div class="console-line">Ready.</div>
                    </div>
                </div>
            </section>

        </main>

        <!-- Footer -->
        <footer class="app-footer">
            <p>WhisperJAV - Subtitle generation for Japanese Adult Videos |
               <a href="#" onclick="showAbout(); return false;" style="color: var(--primary-color); text-decoration: none;">About</a>
            </p>
        </footer>

    </div>

    <!-- About Dialog Modal -->
    <div class="modal-overlay" id="aboutModal">
        <div class="modal-dialog">
            <div class="modal-header">
                <h2>About WhisperJAV</h2>
                <button class="modal-close" onclick="closeAbout()" aria-label="Close">&times;</button>
            </div>
            <div class="modal-body">
                <div class="about-logo">üé¨</div>
                <div class="about-title">WhisperJAV GUI</div>
                <div class="about-version" id="aboutVersion">Version 1.7.2</div>

                <div class="about-section">
                    <h3>Description</h3>
                    <p>Japanese Adult Video Subtitle Generator powered by OpenAI Whisper with specialized enhancements for Japanese language processing, scene detection, and voice activity detection.</p>
                </div>

                <div class="about-section">
                    <h3>Key Features</h3>
                    <ul>
                        <li>Multi-mode processing (Balanced, Fast, Faster)</li>
                        <li>Scene detection and voice activity detection</li>
                        <li>Japanese language optimization</li>
                        <li>Batch processing support</li>
                        <li>Real-time progress monitoring</li>
                    </ul>
                </div>

                <div class="about-section">
                    <h3>Technology</h3>
                    <p>Built with PyWebView and Python. This modern web-based interface provides a clean and intuitive experience for generating high-quality Japanese subtitles.</p>
                </div>

                <div class="about-section">
                    <h3>Keyboard Shortcuts</h3>
                    <ul>
                        <li>Ctrl+O - Add files</li>
                        <li>Ctrl+R - Start processing</li>
                        <li>Escape - Cancel process</li>
                        <li>F1 - Show this dialog</li>
                    </ul>
                </div>

                <div class="about-section">
                    <p style="text-align: center; margin-top: 20px;">
                        <a href="https://github.com/meizhong986/WhisperJAV" class="about-link" target="_blank">Visit GitHub Repository</a>
                    </p>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-primary" onclick="closeAbout()">Close</button>
            </div>
        </div>
    </div>

    <!-- Customize Component Modal -->
    <div class="modal-overlay" id="customizeModal">
        <div class="modal-dialog modal-lg">
            <div class="modal-header">
                <h2 id="customizeModalTitle">Component Settings</h2>
                <button class="modal-close" id="customizeModalClose" aria-label="Close">&times;</button>
            </div>
            <div class="modal-body">
                <!-- Tab Navigation -->
                <div class="modal-tabs">
                    <button class="modal-tab active" data-tab="model">Model</button>
                    <button class="modal-tab" data-tab="transcriber">Transcriber</button>
                    <button class="modal-tab" data-tab="decoder">Decoder</button>
                    <button class="modal-tab" data-tab="engine">Engine</button>
                    <button class="modal-tab" data-tab="vad">VAD</button>
                    <button class="modal-tab" data-tab="scene">Scene</button>
                </div>
                <!-- Tab Panels -->
                <div class="modal-tab-content">
                    <div id="tab-model" class="modal-tab-panel active">
                        <!-- Model selection: model name and device -->
                    </div>
                    <div id="tab-transcriber" class="modal-tab-panel">
                        <!-- Transcriber params: temperature, thresholds, etc. -->
                    </div>
                    <div id="tab-decoder" class="modal-tab-panel">
                        <!-- Decoder params: task, language, beam_size, etc. -->
                    </div>
                    <div id="tab-engine" class="modal-tab-panel">
                        <!-- Engine params: varies by pipeline backend -->
                    </div>
                    <div id="tab-vad" class="modal-tab-panel">
                        <!-- VAD params: threshold, durations, etc. -->
                    </div>
                    <div id="tab-scene" class="modal-tab-panel">
                        <!-- Scene detection: auditok/silero selector -->
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="customizeModalReset">Reset to Defaults</button>
                <button class="btn btn-primary" id="customizeModalApply">Apply</button>
            </div>
        </div>
    </div>

    <!-- JavaScript -->
    <script src="app.js"></script>
</body>
</html>
