<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WhisperJAV - Simple Runner</title>
    <!-- Theme stylesheet (swappable at runtime) -->
    <link id="themeStylesheet" rel="stylesheet" href="style.css">
</head>
<body>
    <!-- Main Application Container -->
    <div class="app-container">

        <!-- Header -->
        <header class="app-header">
            <h1>WhisperJAV</h1>
            <div class="header-actions">
                <!-- Minimal theme switch button -->
                <button id="themeBtn" class="theme-button" aria-label="Theme" title="Theme">
                    ðŸŽ¨
                </button>
                <!-- Tiny popover menu -->
                <div id="themeMenu" class="theme-menu" role="menu" aria-label="Select theme">
                    <button class="theme-option" data-theme="default" role="menuitem">Default Theme</button>
                    <button class="theme-option" data-theme="google" role="menuitem">Google Theme</button>
                    <button class="theme-option" data-theme="carbon" role="menuitem">IBM Carbon Theme</button>
                    <button class="theme-option" data-theme="primer" role="menuitem">GitHub Primer Theme</button>
                </div>
            </div>
        </header>

        <!-- Main Content Area -->
        <main class="app-main">

            <!-- Source Section -->
            <section class="section source-section">
                <div class="section-header">
                    <h2>Source</h2>
                </div>
                <div class="section-content">
                    <!-- File List Display -->
                    <div class="file-list-container" id="fileListContainer">
                        <div class="file-list" id="fileList" tabindex="0">
                            <div class="empty-state" id="emptyState">
                                <span class="empty-icon">ðŸ“‚</span>
                                <p>No files selected</p>
                                <p class="empty-hint">Click "Add File(s)" or "Add Folder" to get started</p>
                            </div>
                        </div>
                    </div>

                    <!-- File Management Buttons -->
                    <div class="button-group">
                        <button type="button" class="btn btn-primary" id="addFilesBtn">
                            Add File(s)
                        </button>
                        <button type="button" class="btn btn-primary" id="addFolderBtn">
                            Add Folder
                        </button>
                        <button type="button" class="btn btn-secondary" id="removeSelectedBtn" disabled>
                            Remove Selected
                        </button>
                        <button type="button" class="btn btn-secondary" id="clearBtn" disabled>
                            Clear
                        </button>
                    </div>
                </div>
            </section>

            <!-- Destination Section -->
            <section class="section destination-section">
                <div class="section-header">
                    <h2>Destination</h2>
                </div>
                <div class="section-content">
                    <div class="output-control">
                        <label for="outputDir" class="control-label">Output:</label>
                        <input
                            type="text"
                            id="outputDir"
                            class="output-path"
                            readonly
                            placeholder="Output directory..."
                        >
                        <button type="button" class="btn btn-secondary" id="browseOutputBtn">
                            Browse
                        </button>
                        <button type="button" class="btn btn-secondary" id="openOutputBtn">
                            Open
                        </button>
                    </div>
                </div>
            </section>

            <!-- Tabbed Options Section -->
            <section class="section tabs-section">
                <div class="tabs-container">
                    <!-- Tab Navigation -->
                    <div class="tab-bar" role="tablist">
                        <button
                            class="tab-button active"
                            role="tab"
                            aria-selected="true"
                            aria-controls="tab1-panel"
                            id="tab1-button"
                            data-tab="tab1"
                        >
                            Transcription Mode
                        </button>
                        <button
                            class="tab-button"
                            role="tab"
                            aria-selected="false"
                            aria-controls="tab2-panel"
                            id="tab2-button"
                            data-tab="tab2"
                        >
                            Transcription Adv. Options
                        </button>
                        <button
                            class="tab-button"
                            role="tab"
                            aria-selected="false"
                            aria-controls="tab3-panel"
                            id="tab3-button"
                            data-tab="tab3"
                        >
                            Ensemble Mode
                        </button>
                    </div>

                    <!-- Tab Content -->
                    <div class="tab-content-container">

                        <!-- Tab 1: Transcription Mode -->
                        <div
                            class="tab-panel active"
                            id="tab1-panel"
                            role="tabpanel"
                            aria-labelledby="tab1-button"
                        >
                            <!-- Row 1: Mode + Sensitivity (left), Source language + Subtitle output (right) -->
                            <div class="form-row form-row-two-column">
                                <!-- Left Column: Mode + Sensitivity -->
                                <div class="form-column">
                                    <!-- Mode Selection -->
                                    <div class="form-group">
                                        <label for="mode" class="form-label">Mode (ASR Engine options):</label>
                                        <select id="mode" class="form-select mode-select">
                                            <option value="fidelity">fidelity&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(large-v2-fp16&nbsp;&nbsp;&nbsp;10GB VRAM)</option>
                                            <option value="balanced" selected>balanced&nbsp;&nbsp;&nbsp;&nbsp;(large-v2-int8&nbsp;&nbsp;&nbsp;&nbsp;6GB VRAM)</option>
                                            <option value="fast">fast&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(turbo-int8&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;4GB VRAM)</option>
                                            <option value="faster">faster&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(turbo-int8-batch8&nbsp;&nbsp;6GB VRAM)</option>
                                            <option value="kotoba-faster-whisper">kotoba&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(kotoba-v2-fp16&nbsp;&nbsp;&nbsp;6GB VRAM)</option>
                                            <option value="anime" disabled>anime (future placeholder)</option>
                                        </select>
                                    </div>

                                    <!-- Sensitivity -->
                                    <div class="form-group">
                                        <label for="sensitivity" class="form-label">Sensitivity (accuracy vs false-positives):</label>
                                        <select id="sensitivity" class="form-select">
                                            <option value="aggressive" selected>aggressive (hi-details, noise)</option>
                                            <option value="balanced">balanced (details, lo-noise)</option>
                                            <option value="conservative">conservative (lo-details, accurate)</option>
                                        </select>
                                    </div>
                                </div>

                                <!-- Right Column: Source Audio Language + Subtitle Output -->
                                <div class="form-column">
                                    <!-- Source Audio Language -->
                                    <div class="form-group">
                                        <label for="source-language" class="form-label">Source audio language:</label>
                                        <select id="source-language" class="form-select">
                                            <option value="japanese" selected>Japanese (æ—¥æœ¬èªž)</option>
                                            <option value="korean">Korean (í•œêµ­ì–´)</option>
                                            <option value="chinese">Chinese (ä¸­æ–‡)</option>
                                            <option value="english">English</option>
                                        </select>
                                    </div>

                                    <!-- Subtitle Output Format -->
                                    <div class="form-group">
                                        <label for="language" class="form-label">Subtitle output:</label>
                                        <select id="language" class="form-select">
                                            <option value="native" selected>Native (transcribe in source language)</option>
                                            <option value="direct-to-english">Direct to English (translate via Whisper)</option>
                                        </select>
                                    </div>
                                </div>
                            </div>

                            <!-- Row 2: Info Labels -->
                            <div class="form-row info-row">
                                <div class="info-group">
                                    <p class="info-text">
                                        Speed vs. Accuracy: 'fast' and 'faster' prioritize throughput; <br>'fidelity' favors accuracy.
                                    </p>
                                </div>
                                <div class="info-group">
                                    <p class="info-text">
                                        Details vs. Noise: 'conservative' reduces false positives; <br>'aggressive' may include noise while capturing more detail.
                                    </p>
                                </div>
                            </div>
                        </div>

                        <!-- Tab 2: Advanced Options -->
                        <div
                            class="tab-panel"
                            id="tab2-panel"
                            role="tabpanel"
                            aria-labelledby="tab2-button"
                        >
                            <!-- Row 1 (new): Model override + model select + Async + Debug -->
                            <div class="form-row" id="adv-row-1">
                                <div class="form-group">
                                    <label class="checkbox-label">
                                        <input type="checkbox" id="modelOverrideEnabled">
                                        <span>Model override</span>
                                    </label>
                                </div>
                                <div class="form-group tight-pair">
                                    <select id="modelSelection" class="form-select" disabled>
                                        <option value="large-v3" selected>large-v3</option>
                                        <option value="large-v2">large-v2</option>
                                        <option value="turbo">turbo</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label class="checkbox-label">
                                        <input type="checkbox" id="asyncProcessing">
                                        <span>Async processing</span>
                                    </label>
                                </div>
                                <div class="form-group">
                                    <label class="checkbox-label">
                                        <input type="checkbox" id="debugLogging">
                                        <span>Debug logging</span>
                                    </label>
                                </div>
                                <div class="form-group inline-field">
                                    <label for="sceneDetectionMethod" class="form-label" style="white-space: nowrap;">Scene detection:</label>
                                    <select id="sceneDetectionMethod" class="form-select">
                                        <option value="">default (auditok)</option>
                                        <option value="auditok">auditok (energy-based)</option>
                                        <option value="silero">silero (VAD-based, experimental)</option>
                                    </select>
                                </div>
                            </div>

                            <!-- Row 2 (new): Opening credit inline -->
                            <div class="form-row" id="adv-row-2">
                                <div class="form-group full-width">
                                    <div class="input-inline">
                                        <label for="openingCredit" class="form-label" style="white-space: nowrap;">Opening credit (Example: Produced by XXX):</label>
                                        <input
                                            type="text"
                                            id="openingCredit"
                                            class="form-input"
                                            placeholder="Optional opening credit text..."
                                        >
                                    </div>
                                </div>
                            </div>

                            <!-- Row 3 (new): Adaptive features + Max workers -->
                            <div class="form-row" id="adv-row-3">
                                <div class="form-group">
                                    <label class="checkbox-label" title="Work in Progress - Not yet implemented">
                                        <input type="checkbox" id="adaptiveClassification" disabled>
                                        <span>Adaptive classification (WIP)</span>
                                    </label>
                                </div>
                                <div class="form-group">
                                    <label class="checkbox-label" title="Work in Progress - Not yet implemented">
                                        <input type="checkbox" id="adaptiveEnhancement" disabled>
                                        <span>Adaptive audio enhancements (WIP)</span>
                                    </label>
                                </div>
                                <div class="form-group">
                                    <label class="checkbox-label" title="Work in Progress - Not yet implemented">
                                        <input type="checkbox" id="smartPostprocessing" disabled>
                                        <span>Smart postprocessing (WIP)</span>
                                    </label>
                                </div>
                                <div class="form-group inline-field">
                                    <label for="maxWorkers" class="form-label" style="white-space: nowrap;">Max workers:</label>
                                    <input
                                        type="number"
                                        id="maxWorkers"
                                        class="form-input"
                                        value="1"
                                        min="1"
                                        max="16"
                                        style="width: 80px;"
                                    >
                                </div>
                            </div>

                            <!-- Row 4 (new): Keep temp files + Temp directory -->
                            <div class="form-row" id="adv-row-4">
                                <div class="form-group">
                                    <label class="checkbox-label">
                                        <input type="checkbox" id="keepTemp">
                                        <span>Keep temp files</span>
                                    </label>
                                </div>
                                <div class="form-group temp-dir-group inline-field">
                                    <label for="tempDir" class="form-label" style="white-space: nowrap;">Temp dir:</label>
                                    <div class="input-with-button">
                                        <input
                                            type="text"
                                            id="tempDir"
                                            class="form-input"
                                            placeholder="Default system temp directory"
                                        >
                                        <button type="button" class="btn btn-secondary btn-sm" id="browseTempBtn">
                                            Browse
                                        </button>
                                    </div>
                                </div>
                            </div>

                            <!-- Row 5: Accept CPU mode -->
                            <div class="form-row" id="adv-row-5">
                                <div class="form-group">
                                    <label class="checkbox-label" title="Skip GPU performance warning and accept CPU-only mode">
                                        <input type="checkbox" id="acceptCpuMode">
                                        <span>Accept CPU-only mode (skip GPU warning)</span>
                                    </label>
                                </div>
                            </div>
                        </div>

                        <!-- Tab 3: Two-Pass Ensemble Mode -->
                        <div
                            class="tab-panel"
                            id="tab3-panel"
                            role="tabpanel"
                            aria-labelledby="tab3-button"
                        >
                            <div class="ensemble-twopass-container">
                                <!-- Pass 1 Row -->
                                <div class="pass-row">
                                    <span class="pass-label">Pass 1</span>
                                    <div class="pass-controls">
                                        <label for="pass1-pipeline" class="control-label">Pipeline:</label>
                                        <select id="pass1-pipeline" class="form-select compact">
                                            <option value="balanced" selected>Balanced</option>
                                            <option value="fast">Fast</option>
                                            <option value="faster">Faster</option>
                                            <option value="fidelity">Fidelity</option>
                                            <option value="kotoba-faster-whisper">Kotoba (Japanese)</option>
                                        </select>
                                        <label for="pass1-sensitivity" class="control-label">Sensitivity:</label>
                                        <select id="pass1-sensitivity" class="form-select compact">
                                            <option value="aggressive">Aggressive</option>
                                            <option value="balanced" selected>Balanced</option>
                                            <option value="conservative">Conservative</option>
                                        </select>
                                        <button type="button" class="btn btn-secondary btn-compact" id="customize-pass1">
                                            Customize Parameters
                                        </button>
                                    </div>
                                    <span id="pass1-badge" class="pass-badge default">DEFAULT</span>
                                </div>

                                <!-- Pass 2 Row -->
                                <div class="pass-row">
                                    <label class="pass-label checkbox-label">
                                        <input type="checkbox" id="pass2-enabled">
                                        <span>Enable Pass 2</span>
                                    </label>
                                    <div class="pass-controls" id="pass2-content">
                                        <label for="pass2-pipeline" class="control-label">Pipeline:</label>
                                        <select id="pass2-pipeline" class="form-select compact" disabled>
                                            <option value="balanced">Balanced</option>
                                            <option value="fast">Fast</option>
                                            <option value="faster">Faster</option>
                                            <option value="fidelity" selected>Fidelity</option>
                                            <option value="kotoba-faster-whisper">Kotoba (Japanese)</option>
                                        </select>
                                        <label for="pass2-sensitivity" class="control-label">Sensitivity:</label>
                                        <select id="pass2-sensitivity" class="form-select compact" disabled>
                                            <option value="aggressive">Aggressive</option>
                                            <option value="balanced" selected>Balanced</option>
                                            <option value="conservative">Conservative</option>
                                        </select>
                                        <button type="button" class="btn btn-secondary btn-compact" id="customize-pass2" disabled>
                                            Customize Parameters
                                        </button>
                                    </div>
                                    <span id="pass2-badge" class="pass-badge default">DEFAULT</span>
                                </div>

                                <!-- Merge Strategy Row -->
                                <div class="merge-row">
                                    <label for="merge-strategy" class="control-label">Merge Strategy:</label>
                                    <select id="merge-strategy" class="form-select merge-select" disabled>
                                        <option value="smart_merge" selected>Smart Merge (Best Quality)</option>
                                        <option value="full_merge">Full Merge (All Lines)</option>
                                        <option value="pass1_primary">Pass 1 + Fill From Pass 2</option>
                                        <option value="pass2_primary">Pass 2 + Fill From Pass 1</option>
                                        <option value="pass1_overlap">Pass 1 + Fill (30% Overlap)</option>
                                        <option value="pass2_overlap">Pass 2 + Fill (30% Overlap)</option>
                                    </select>
                                </div>

                                <!-- Info Footer -->
                                <div class="ensemble-info">
                                    <p>Two-pass ensemble runs two different pipeline configurations and merges results for improved quality.</p>
                                    <p>Click "Customize Parameters" to adjust detailed settings for each pass.</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Run Controls Section -->
            <section class="section run-section">
                <div class="section-content">
                    <!-- Progress Bar -->
                    <div class="progress-container">
                        <div class="progress-bar" id="progressBar">
                            <div class="progress-fill" id="progressFill"></div>
                        </div>
                        <span class="status-label" id="statusLabel">Idle</span>
                    </div>

                    <!-- Control Buttons -->
                    <div class="button-group">
                        <button type="button" class="btn btn-primary btn-lg" id="startBtn">
                            Start
                        </button>
                        <button type="button" class="btn btn-secondary btn-lg" id="cancelBtn" disabled>
                            Cancel
                        </button>
                    </div>
                </div>
            </section>

            <!-- Console Section -->
            <section class="section console-section">
                <div class="section-header">
                    <h2>Console</h2>
                    <button type="button" class="btn btn-text btn-sm" id="clearConsoleBtn">
                        Clear
                    </button>
                </div>
                <div class="section-content">
                    <div class="console-output" id="consoleOutput">
                        <div class="console-line">Ready.</div>
                    </div>
                </div>
            </section>

        </main>

        <!-- Footer -->
        <footer class="app-footer">
            <p>WhisperJAV - Subtitle generation for Japanese Adult Videos |
               <a href="#" onclick="showAbout(); return false;" style="color: var(--primary-color); text-decoration: none;">About</a>
            </p>
        </footer>

    </div>

    <!-- About Dialog Modal -->
    <div class="modal-overlay" id="aboutModal">
        <div class="modal-dialog">
            <div class="modal-header">
                <h2>About WhisperJAV</h2>
                <button class="modal-close" onclick="closeAbout()" aria-label="Close">&times;</button>
            </div>
            <div class="modal-body">
                <div class="about-logo">ðŸŽ¬</div>
                <div class="about-title">WhisperJAV GUI</div>
                <div class="about-version" id="aboutVersion">Version 1.6.1</div>

                <div class="about-section">
                    <h3>Description</h3>
                    <p>Japanese Adult Video Subtitle Generator powered by OpenAI Whisper with specialized enhancements for Japanese language processing, scene detection, and voice activity detection.</p>
                </div>

                <div class="about-section">
                    <h3>Key Features</h3>
                    <ul>
                        <li>Multi-mode processing (Balanced, Fast, Faster)</li>
                        <li>Scene detection and voice activity detection</li>
                        <li>Japanese language optimization</li>
                        <li>Batch processing support</li>
                        <li>Real-time progress monitoring</li>
                    </ul>
                </div>

                <div class="about-section">
                    <h3>Technology</h3>
                    <p>Built with PyWebView and Python. This modern web-based interface provides a clean and intuitive experience for generating high-quality Japanese subtitles.</p>
                </div>

                <div class="about-section">
                    <h3>Keyboard Shortcuts</h3>
                    <ul>
                        <li>Ctrl+O - Add files</li>
                        <li>Ctrl+R - Start processing</li>
                        <li>Escape - Cancel process</li>
                        <li>F1 - Show this dialog</li>
                    </ul>
                </div>

                <div class="about-section">
                    <p style="text-align: center; margin-top: 20px;">
                        <a href="https://github.com/meizhong986/WhisperJAV" class="about-link" target="_blank">Visit GitHub Repository</a>
                    </p>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-primary" onclick="closeAbout()">Close</button>
            </div>
        </div>
    </div>

    <!-- Customize Component Modal -->
    <div class="modal-overlay" id="customizeModal">
        <div class="modal-dialog modal-lg">
            <div class="modal-header">
                <h2 id="customizeModalTitle">Component Settings</h2>
                <button class="modal-close" id="customizeModalClose" aria-label="Close">&times;</button>
            </div>
            <div class="modal-body">
                <!-- Tab Navigation -->
                <div class="modal-tabs">
                    <button class="modal-tab active" data-tab="model">Model</button>
                    <button class="modal-tab" data-tab="transcriber">Transcriber</button>
                    <button class="modal-tab" data-tab="decoder">Decoder</button>
                    <button class="modal-tab" data-tab="engine">Engine</button>
                    <button class="modal-tab" data-tab="vad">VAD</button>
                    <button class="modal-tab" data-tab="scene">Scene</button>
                </div>
                <!-- Tab Panels -->
                <div class="modal-tab-content">
                    <div id="tab-model" class="modal-tab-panel active">
                        <!-- Model selection: model name and device -->
                    </div>
                    <div id="tab-transcriber" class="modal-tab-panel">
                        <!-- Transcriber params: temperature, thresholds, etc. -->
                    </div>
                    <div id="tab-decoder" class="modal-tab-panel">
                        <!-- Decoder params: task, language, beam_size, etc. -->
                    </div>
                    <div id="tab-engine" class="modal-tab-panel">
                        <!-- Engine params: varies by pipeline backend -->
                    </div>
                    <div id="tab-vad" class="modal-tab-panel">
                        <!-- VAD params: threshold, durations, etc. -->
                    </div>
                    <div id="tab-scene" class="modal-tab-panel">
                        <!-- Scene detection: auditok/silero selector -->
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="customizeModalReset">Reset to Defaults</button>
                <button class="btn btn-primary" id="customizeModalApply">Apply</button>
            </div>
        </div>
    </div>

    <!-- JavaScript -->
    <script src="app.js"></script>
</body>
</html>
